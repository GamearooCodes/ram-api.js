<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Utils/utilsNew.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Utils/utilsNew.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { Logger } = require("simply-logger");
const { series } = require("async");
const { exec } = require("child_process");
const axios = require("axios");
const packageJson = require("package-json");
const chalk = require("chalk");

const logger = new Logger("ram-api.js", "America/New_York", 12);
const apilogger = new Logger("Ram Api", "America/New_York", 12);
const curVer = require("../package.json").version;
const publicCheck = ["v10", "v11", "v12"];

/**
 * Utility class for various helper functions.
 */
class Utils {
  /**
   * Creates an instance of Utils.
   */
  constructor() {}

  /**
   * Updates the package asynchronously.
   *
   * @param {string} version - The version to update to (default is "latest").
   * @returns {Promise&lt;boolean>} - A promise that resolves with true if the update is successful, otherwise false.
   */
  async updatePackageAsync(version = "latest") {
    // Update package using npm and echo the update
    let cmd = `npm i ram-api.js@${version}`;
    let cmd2 = `echo "Update for ram-api.js to ${version}"`;
    series([() => exec(cmd), () => exec(cmd2)]);
    setTimeout(() => console.log("done"), 3000);

    try {
      let version2 = await packageJson("ram-api.js", { version: version });
      return curVer === version2.version;
    } catch (error) {
      return false;
    }
  }

  /**
   * Checks the package version asynchronously.
   *
   * @returns {Promise&lt;Object>} - A promise that resolves with version information and outdated status.
   */
  async packageVersionCheckAsync() {
    return new Promise(async (resolve, reject) => {
      var dev = false;
      let ran = false;

      if (dev) {
        try {
          logger.warn("Warning this is a dev build use at your own risk");

          let version = await packageJson("ram-api.js", { version: "dev" });

          if (ran) return;
          if (curVer !== version.version) {
            resolve({
              log: `Dev Package is out of date to update run ${chalk.magenta(
                `npm i ram-api.js@dev`
              )} to update latest version is ${chalk.magenta(version.version)}`,
              outdated: true,
            });
            ran = true;
          } else {
            resolve({
              log: "Package Up to date",
              outdated: false,
            });
          }
        } catch (error) {
          reject(error);
        }
      }

      if (!dev) {
        try {
          let version = await packageJson("ram-api.js", { version: "latest" });

          if (ran) return;
          if (curVer !== version.version) {
            resolve({
              log: `Package is out of date to update run ${chalk.magenta(
                `npm i ram-api.js@latest`
              )} to update latest version is ${chalk.magenta(version.version)}`,
              outdated: true,
            });
            ran = true;
          } else {
            resolve({
              log: "Package Up to date",
              outdated: false,
            });
          }
        } catch (error) {
          reject(error);
        }
      }
    });
  }

  /**
   * Performs a ping request asynchronously.
   *
   * @returns {Promise&lt;any>} - A promise that resolves with the ping response data.
   */
  async pingAsync() {
    let dat = Date.now();

    let p = new Promise(async (resolve, reject) => {
      await axios
        .get(`/ping`, {
          headers: {
            "Content-Type": "application/json",
          },
          baseURL: `https://api.rambot.xyz/basic/v12/utils`,
        })
        .then(async function (res) {
          resolve(res.data);
        })
        .catch(async (error) => {
          reject("Ping Failed! " + error);
        });
    });
  }

  /**
   * Fetches data from the specified API endpoint based on the provided access level.
   *
   * @param {string} endpoint - The API endpoint to request data from.
   * @param {string} accessLevel - The access level for the request ("normal", "extended", "demo", "pro").
   * @param {Object} _options - Options object containing version, params, and headers.
   * @param {string} _options.version - The version to use (latest is v14).
   * @param {Object} _options.params - Query parameters for the request.
   * @param {Object} _options.headers - Custom headers for the request. If not demo, {"api-key": "key goes here"}.
   * @returns {Promise&lt;any>} - A promise that resolves with the fetched data or rejects with an error message.
   */
  async customAsync(endpoint, accessLevel = "normal", _options = {}) {
    endpoint, // something like /hello or /ram
      (accessLevel = "normal"), // the type to use
      (_options = {}); // options object containing version, params, and headers

    return new Promise(async (resolve, reject) => {
      const supportedVersions = ["v14"];
      const outdatedVersions = ["v11", "v12", "v13"];
      const notsupported = [
        "v0",
        "v1",
        "v2",
        "v3",
        "v4",
        "v5",
        "v6",
        "v7",
        "v8",
        "v9",
        "v10",
      ];
      const requestedVersion = _options.version || "v14";

      if (supportedVersions.includes(requestedVersion)) {
      } else if (outdatedVersions.includes(requestedVersion)) {
        logger.warn(
          `${requestedVersion} is outdated please update to the latest ${supportedVersions[0]}`
        );
      } else if (notsupported.includes(requestedVersion)) {
        logger.error(`${requestedVersion} is no longer supported`);
        return reject("Check console");
      }

      let baseURL = "NULL";

      if (accessLevel === "normal") {
        baseURL = `https://api.rambot.xyz/${requestedVersion}`;
      } else if (accessLevel === "extended") {
        baseURL = `https://api.rambot.xyz/extended/${requestedVersion}`;
      } else if (accessLevel === "demo") {
        baseURL = "https://api.rambot.xyz/demo";
      } else if (accessLevel === "pro") {
        baseURL = `https://api.rambot.xyz/pro/${requestedVersion}`;
      }

      try {
        const response = await axios({
          method: "get",
          url: endpoint,
          params: _options.params || {},
          baseURL: baseURL,
          headers: _options.headers || {},
        });

        resolve(response.data);
      } catch (error) {
        logger.error(error);
        reject(error);
      }
    });
  }
}

/**
 * Handles errors and logs them.
 *
 * @param {string} name - The name of the operation where the error occurred.
 * @param {Error} error - The error object.
 */
async function errors(name, error) {
  if (error.response) {
    // ... (remaining code for handling errors with responses)
  } else {
    console.log(error);
    logger.error(
      `error running ${name}. Please report to the developers the error logged into your console!`
    );
  }
}

module.exports = { Utils };
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ExecuteConsole.html">ExecuteConsole</a></li><li><a href="RamApi.html">RamApi</a></li><li><a href="RamApiBeta.html">RamApiBeta</a></li><li><a href="RamApiDemo.html">RamApiDemo</a></li><li><a href="RamApiPro.html">RamApiPro</a></li><li><a href="Utils.html">Utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#apilogger">apilogger</a></li><li><a href="global.html#baseURL">baseURL</a></li><li><a href="global.html#errors">errors</a></li><li><a href="global.html#logger">logger</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Aug 27 2023 15:06:30 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
